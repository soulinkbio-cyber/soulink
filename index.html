<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Soulink • Perfil</title>
<meta name="description" content="Conecta conmigo con un toque. Camisas Soulink NFC." />
<meta name="theme-color" content="#ffffff" />
<style>
  html,body{margin:0;padding:0;background:#ffffff;color:#111;font-family: -apple-system,system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:720px;margin:0 auto;padding:28px 18px}
  .top{display:flex;flex-direction:column;align-items:center;margin:8px 0 14px}
  .avatar{width:120px;height:120px;border-radius:999px;overflow:hidden;border:1px solid #e6e6e6;background:#f5f5f5}
  .avatar img{width:100%;height:100%;object-fit:cover}
  .uname{font-size:28px;font-weight:800;margin:12px 0 2px}
  .brand{font-size:13px;color:#7a7a7a;margin-bottom:12px}
  .buttons{display:flex;flex-direction:column;gap:12px;margin:18px 0 10px}
  .btn{display:flex;align-items:center;justify-content:center;gap:10px;height:52px;border-radius:10px;text-decoration:none;color:#fff;font-weight:800;border:1px solid rgba(0,0,0,.06)}
  .ig{background:#d62976}
  .fb{background:#1877f2}
  .tt{background:#000}
  .yt{background:#ff0000}
  .em{background:#6d6d6d}
  .wa{background:#25d366;color:#003b16}
  .foot{margin-top:22px;text-align:center;color:#6b6b6b;font-size:12px}
  .muted{color:#9a9a9a}
  .hidden{display:none !important}
  .notfound{text-align:center;color:#b00020;background:#fff7f7;border:1px solid #ffd6d6;border-radius:10px;padding:14px;margin-top:16px}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="avatar"><img id="avatar" alt="Avatar"></div>
    <div id="uname" class="uname">@usuario</div>
    <div id="name" class="brand">Soulink profile</div>
  </div>

  <div class="buttons" id="btns">
    <a id="btn-ig" class="btn ig hidden" target="_blank" rel="noopener">Instagram</a>
    <a id="btn-fb" class="btn fb hidden" target="_blank" rel="noopener">Facebook</a>
    <a id="btn-tt" class="btn tt hidden" target="_blank" rel="noopener">TikTok</a>
    <a id="btn-yt" class="btn yt hidden" target="_blank" rel="noopener">YouTube</a>
    <a id="btn-wa" class="btn wa hidden" target="_blank" rel="noopener">WhatsApp</a>
    <a id="btn-em" class="btn em hidden">Email</a>
  </div>

  <div id="msg" class="notfound hidden">No encontré este usuario. Revisa el enlace.</div>
  <div class="foot">© Soulink NFC • Conecta con un toque</div>
</div>

<script>
  // === CONFIG ===
  const SHEET_ID = "1mJt5VUh7g9PUHhPrWBpJiJdGp5y5EdXfEquodIC9xdE";
  const SHEET_NAME = "Profiles";

  // Lee el username de la URL (soporta ?u=manu y /@manu)
  function getUsernameFromURL() {
    const q = new URLSearchParams(location.search);
    const qU = q.get('u');
    if (qU) return qU.trim().toLowerCase();
    const m = location.pathname.match(/\/\@([^\/\?#]+)/);
    if (m) return decodeURIComponent(m[1]).trim().toLowerCase();
    return "";
  }

  const $ = (id)=>document.getElementById(id);
  const show = (el)=>el.classList.remove('hidden');
  const hide = (el)=>el.classList.add('hidden');

  async function loadSheetMap() {
    // Requiere: Archivo -> Publicar en la web (Sheet: Profiles)
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;
    const txt = await fetch(url, { cache: 'no-store' }).then(r => r.text());
    // Extraer JSON del wrapper gviz
    const start = txt.indexOf('{');
    const end = txt.lastIndexOf('}') + 2;
    const jsonStr = txt.slice(start, end);
    const data = JSON.parse(jsonStr);
    const cols = data.table.cols.map(c => (c.label||'').toLowerCase());
    const rows = data.table.rows || [];
    const map = {};
    for (const r of rows) {
      const obj = {}, cells = r.c;
      cols.forEach((label,i)=>{ obj[label] = cells[i] && (cells[i].v!==null) ? String(cells[i].v) : ""; });
      if (obj.username) map[obj.username.toLowerCase()] = obj;
    }
    return map;
  }

  function setHrefOrHide(id, url) {
    const el = $(id);
    if (!url) return hide(el);
    el.href = url; show(el);
  }
  function setMailOrHide(id, email) {
    const el = $(id);
    if (!email) return hide(el);
    el.href = 'mailto:' + email; show(el);
  }

  async function init() {
    const user = getUsernameFromURL();
    if (!user) { show($('msg')); $('msg').textContent = 'Falta el usuario en el enlace. Usa ?u=manu360 o /@manu360'; return; }
    try {
      const all = await loadSheetMap();
      const p = all[user];
      if (!p) throw new Error('notfound');
      $('avatar').src = p.avatar || 'https://avatars.githubusercontent.com/u/583231?v=4';
      $('uname').textContent = '@' + p.username;
      $('name').textContent = p.name || p.username;

      setHrefOrHide('btn-ig', p.instagram);
      setHrefOrHide('btn-fb', p.facebook);
      setHrefOrHide('btn-tt', p.tiktok);
      setHrefOrHide('btn-yt', p.youtube);
      setHrefOrHide('btn-wa', p.whatsapp);
      setMailOrHide('btn-em', p.email);
    } catch(e) {
      show($('msg'));
    }
  }
  init();
</script>
</body>
</html>
