<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Soulink • Perfil</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
  --bg: #fff;
  --text: #111;
  --muted: #666;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Inter', -apple-system, system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}
.wrap {
  width: 100%;
  max-width: 400px;
  text-align: center;
  padding: 30px 18px;
}
.avatar {
  width: 130px;
  height: 130px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #ddd;
  margin-bottom: 10px;
}
.uname {
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 25px;
}
.links {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 18px;
}
.link-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 58px;
  height: 58px;
  border-radius: 50%;
  color: white;
  text-decoration: none;
  font-size: 24px;
  transition: transform 0.2s, opacity 0.2s;
}
.link-btn:hover { transform: scale(1.1); opacity: 0.9; }
.ig { background: #d62976; }
.fb { background: #1877f2; }
.tt { background: #000; }
.yt { background: #ff0000; }
.wa { background: #25d366; }
.em { background: #6d6d6d; }
.msg {
  margin-top: 15px;
  color: #b00020;
  background: #fff7f7;
  border: 1px solid #ffd6d6;
  border-radius: 10px;
  padding: 12px;
}
.foot {
  margin-top: 30px;
  color: #aaa;
  font-size: 12px;
}
</style>
</head>

<body>
<div class="wrap">
  <img id="avatar" class="avatar" src="https://i.pravatar.cc/300?img=12" alt="avatar">
  <div id="uname" class="uname">@usuario</div>

  <div class="links">
    <a id="btn-ig" class="link-btn ig" href="#" target="_blank" style="display:none;"><i class="fab fa-instagram"></i></a>
    <a id="btn-fb" class="link-btn fb" href="#" target="_blank" style="display:none;"><i class="fab fa-facebook-f"></i></a>
    <a id="btn-tt" class="link-btn tt" href="#" target="_blank" style="display:none;"><i class="fab fa-tiktok"></i></a>
    <a id="btn-yt" class="link-btn yt" href="#" target="_blank" style="display:none;"><i class="fab fa-youtube"></i></a>
    <a id="btn-wa" class="link-btn wa" href="#" target="_blank" style="display:none;"><i class="fab fa-whatsapp"></i></a>
    <a id="btn-em" class="link-btn em" href="#" style="display:none;"><i class="fas fa-envelope"></i></a>
  </div>

  <div id="msg" class="msg" style="display:none;"></div>
  <div class="foot">© Soulink NFC</div>
</div>

<script>
function getUsername() {
  const q = new URLSearchParams(location.search);
  const u = q.get('u');
  if (u) return u.trim().toLowerCase();
  const m = location.pathname.match(/\/@([^\/?#]+)/);
  if (m) return decodeURIComponent(m[1]).trim().toLowerCase();
  return "";
}

const SHEET_TSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8qA-po2EufvnIotOaNgFsvfQqOMOFMR4KyaIGramGsEErGpOzckJYN2nPMvfsdnqoC34w_DawjNdA/pub?output=tsv";

async function loadTSV() {
  const res = await fetch(SHEET_TSV, { cache: 'no-store' });
  if (!res.ok) throw new Error('no_tsv');
  const txt = await res.text();
  const lines = txt.split(/\r?\n/).filter(l => l.trim() !== "");
  const rows = lines.map(l => l.split('\t'));
  const headers = rows[0].map(h => h.trim().toLowerCase());
  const data = rows.slice(1).map(r => {
    const o = {};
    headers.forEach((h, i) => o[h] = r[i] ? r[i].trim() : "");
    return o;
  });
  const map = {};
  data.forEach(o => { if (o.username) map[o.username.toLowerCase()] = o });
  return map;
}

const $ = id => document.getElementById(id);
const showMsg = t => { const m = $('msg'); m.textContent = t; m.style.display = 'block'; };
const setHref = (id, url) => { const el = $(id); if (url) { el.href = url; el.style.display = 'flex'; } };
const setMail = (id, email) => { const el = $(id); if (email) { el.href = 'mailto:' + email; el.style.display = 'flex'; } };

(async () => {
  try {
    const u = getUsername();
    if (!u) { showMsg('Falta el usuario en el enlace. Usa ?u=manu360 o /@manu360'); return; }
    const map = await loadTSV();
    const p = map[u];
    if (!p) { showMsg('No encontré este usuario en la hoja.'); return; }

    $('uname').textContent = '@' + (p.username || u);
    $('avatar').src = p.avatar || 'https://i.pravatar.cc/300?img=12';

    setHref('btn-ig', p.instagram);
    setHref('btn-fb', p.facebook);
    setHref('btn-tt', p.tiktok);
    setHref('btn-yt', p.youtube);
    setHref('btn-wa', p.whatsapp || p.wa);
    setMail('btn-em', p.email);
  } catch (e) {
    showMsg('No pude leer datos. Verifica que la hoja esté publicada.');
    console.error(e);
  }
})();
</script>
</body>
</html>
