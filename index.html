<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Soulink • Perfil</title>
  <style>
    :root { --fg:#111; --muted:#666; --soft:#f6f6f6; }
    * { box-sizing: border-box }
    body { margin:0; font-family:-apple-system,system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif; color:var(--fg); background:#fff }
    .wrap { max-width:720px; margin:0 auto; padding:28px 18px; text-align:center }
    .avatar { width:120px; height:120px; border-radius:999px; object-fit:cover; border:1px solid #eee; background:var(--soft) }
    .uname { font-size:26px; font-weight:800; margin:12px 0 2px }
    .name { color:var(--muted); margin-bottom:12px }
    .buttons a { display:block; margin:10px 0; padding:14px; border-radius:12px; text-decoration:none; color:#fff; font-weight:800 }
    .ig { background:#d62976 } .fb { background:#1877f2 } .tt { background:#000 } .yt { background:#ff0000 } .wa { background:#25d366; color:#003b16 } .em { background:#6d6d6d }
    .msg { margin-top:14px; color:#b00020; background:#fff7f7; border:1px solid #ffd6d6; border-radius:10px; padding:12px }
    .foot { margin-top:18px; color:#888; font-size:12px }
    .skeleton { animation:pulse 1.2s ease-in-out infinite; background:#eee }
    @keyframes pulse { 0%{opacity:.6} 50%{opacity:1} 100%{opacity:.6} }
  </style>
</head>
<body>
<div class="wrap">
  <img id="avatar" class="avatar skeleton" alt="avatar" />
  <div id="uname" class="uname skeleton" style="display:inline-block;min-width:140px;height:28px;border-radius:8px"></div>
  <div id="realname" class="name skeleton" style="display:inline-block;min-width:200px;height:18px;border-radius:6px"></div>

  <div id="btns" class="buttons">
    <a id="btn-ig" class="ig" target="_blank" rel="noopener" style="display:none">Instagram</a>
    <a id="btn-fb" class="fb" target="_blank" rel="noopener" style="display:none">Facebook</a>
    <a id="btn-tt" class="tt" target="_blank" rel="noopener" style="display:none">TikTok</a>
    <a id="btn-yt" class="yt" target="_blank" rel="noopener" style="display:none">YouTube</a>
    <a id="btn-wa" class="wa" target="_blank" rel="noopener" style="display:none">WhatsApp</a>
    <a id="btn-em" class="em" style="display:none">Email</a>
  </div>

  <div id="msg" class="msg" style="display:none"></div>
  <div class="foot">© Soulink NFC</div>
</div>

<script>
  // 1) USERNAME: soporta ?u=manu y /@manu
  function getUsername() {
    const q = new URLSearchParams(location.search);
    const u = q.get('u');
    if (u) return u.trim().toLowerCase();
    const m = location.pathname.match(/\/@([^\/\?#]+)/);
    if (m) return decodeURIComponent(m[1]).trim().toLowerCase();
    return "";
  }

  // 2) URL del TSV publicado desde tu Google Sheet
  // (Tomé tu pubhtml y lo convertí a TSV)
  const SHEET_TSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ8qA-po2EufvnIotOaNgFsvfQqOMOFMR4KyaIGramGsEErGpOzckJYN2nPMvfsdnqoC34w_DawjNdA/pub?output=tsv";

  async function loadTSV() {
    const res = await fetch(SHEET_TSV, { cache:'no-store' });
    if (!res.ok) throw new Error('no_tsv');
    const txt = await res.text();
    const lines = txt.split(/\r?\n/).filter(l => l.trim() !== "");
    const rows = lines.map(line => line.split('\t'));
    const headers = rows[0].map(h => (h||"").trim().toLowerCase());
    const data = rows.slice(1).map(r => {
      const obj = {};
      headers.forEach((h,i) => obj[h] = (r[i]||'').trim());
      return obj;
    });
    const map = {};
    data.forEach(obj => {
      if (obj.username) map[obj.username.toLowerCase()] = obj;
    });
    return map;
  }

  const $ = id => document.getElementById(id);
  const showMsg = t => { const m=$('msg'); m.textContent=t; m.style.display='block'; };
  const setHref = (id, url) => { const el=$(id); if(url){ el.href=url; el.style.display='block'; } };
  const setMail = (id, email) => { const el=$(id); if(email){ el.href='mailto:'+email; el.style.display='block'; } };

  (async () => {
    try {
      const u = getUsername();
      if (!u) { showMsg('Falta el usuario en el enlace. Usa ?u=manu360 o /@manu360'); return; }

      const map = await loadTSV();
      const p = map[u];
      if (!p) { showMsg('No encontré este usuario en la hoja.'); return; }

      $('uname').classList.remove('skeleton');
      $('realname').classList.remove('skeleton');
      $('avatar').classList.remove('skeleton');

      $('uname').textContent = '@' + (p.username || u);
      $('realname').textContent = p.name || p.username || u;
      $('avatar').src = p.avatar || 'https://i.pravatar.cc/300?img=12';

      const wa = p.wa || p.whatsapp || "";
      setHref('btn-ig', p.instagram);
      setHref('btn-fb', p.facebook);
      setHref('btn-tt', p.tiktok);
      setHref('btn-yt', p.youtube);
      setHref('btn-wa', wa);
      setMail('btn-em', p.email);
    } catch (e) {
      showMsg('No pude leer datos. Verifica que la hoja esté publicada y accesible.');
      console.error(e);
    }
  })();
</script>
</body>
</html>
