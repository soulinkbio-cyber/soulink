
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Soulink Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 50px; }
    .avatar { border-radius: 50%; width: 120px; height: 120px; }
    .username { font-size: 24px; font-weight: bold; margin-top: 10px; }
    .links { margin-top: 20px; }
    .links a { display: block; margin: 8px; text-decoration: none; color: white; background: #0073e6; padding: 10px; border-radius: 6px; }
  </style>
</head>
<body>
  <div id="profile">
    <img id="avatar" class="avatar" src="" alt="avatar">
    <div id="username" class="username">@usuario</div>
    <div id="name"></div>
    <div id="bio"></div>
    <div id="links" class="links"></div>
  </div>

  <script>
    // Captura el username de la URL (?u=manu360)
    function getUsernameFromURL() {
      const q = new URLSearchParams(location.search);
      const qu = q.get('u');
      if (qu) return qu.trim().toLowerCase();
      const m = location.pathname.match(/@([^/]+)/);
      if (m) return decodeURIComponent(m[1]).trim().toLowerCase();
      return "";
    }

    async function loadSheetData() {
      const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRJvg1A6WKFanh6H_nECt5M-vz1ORKxce5xNJlfjnnuC9NCvGGwBD47L52aqmXMY_HgnhjmMLyg1Qo/pub?output=tsv";
      const resp = await fetch(url);
      const text = await resp.text();

      const rows = text.split("\n").map(r => r.split("\t"));
      const headers = rows[0].map(h => h.toLowerCase());
      const users = rows.slice(1);

      const username = getUsernameFromURL();
      const user = users.find(r => r[headers.indexOf("username")].toLowerCase() === username);

      if (!user) {
        document.getElementById("username").innerText = "@usuario";
        document.getElementById("bio").innerText = "No encontrÃ© este usuario. Revisa el enlace.";
        return;
      }

      // Rellenar datos
      document.getElementById("username").innerText = "@" + user[headers.indexOf("username")];
      document.getElementById("name").innerText = user[headers.indexOf("name")];
      document.getElementById("bio").innerText = user[headers.indexOf("bio")];
      document.getElementById("avatar").src = user[headers.indexOf("avatar")];

      // Links
      const linksDiv = document.getElementById("links");
      headers.forEach((h, i) => {
        if (["username","name","bio","avatar","timestamp"].includes(h)) return;
        const val = user[i];
        if (val && val.startsWith("http")) {
          const a = document.createElement("a");
          a.href = val;
          a.innerText = h;
          a.target = "_blank";
          linksDiv.appendChild(a);
        }
      });
    }

    loadSheetData();
  </script>
</body>
</html>
